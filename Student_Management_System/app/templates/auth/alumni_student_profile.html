{% extends 'base.html' %}
{% block title %}AlumniConnect — Dashboard{% endblock %}

  {% block styles %}
  {{ super() }}
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href= "{{url_for('static', filename='css/alumni_student_dashboard.css')}}" rel="stylesheet">
  {% endblock %}

{% block content %}
  <aside class="sidebar" id="sidebar">
    <div class="brand"><span class="dot"></span> AlumniConnect</div>

    <nav id="nav">
      <a class="nav-btn active" data-target="home"><i class="fas fa-home"></i><span>Home</span></a>
      <a class="nav-btn" data-target="events"><i class="fas fa-calendar"></i><span>Events</span></a>
      <a class="nav-btn" data-target="profile"><i class="fas fa-user-circle"></i><span>Profile</span></a>
      <a class="nav-btn" data-target="projects"><i class="fas fa-briefcase"></i><span>Projects</span></a>      
      <a class="nav-btn" data-target="directory"><i class="fas fa-address-book"></i><span>Directory</span></a>
      <a class="nav-btn" id="logout-btn" data-target="logout"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a>
    </nav>

    <div class="spacer"></div>

    <div class="quick-actions">
      <button class="qa-btn" id="create-event">+ Create Event</button>
      <button class="qa-btn secondary" id="broadcast">Broadcast</button>
    </div>
  </aside>

  <main class="main">

    <div class="top-row">
      <div style="display:flex;align-items:center;gap:12px">
        <button class="hamburger" id="hamburger"><i class="fas fa-bars"></i></button>
        <div class="welcome">Welcome!!</div>
      </div>

      <div class="search-row">
        <div class="search"><i class="fas fa-search"></i><input id="globalSearch" placeholder="Search alumni or events..." /></div>
      </div>
    </div>

    <section id="home" class="page">
      <div class="grid">
        <div class="col-left">
          <div class="profile-card card">
            <div class="avatar" id="avatar">
              <img id="avatar-img" src="{{ url_for('static', filename='images/' + student_data.photo) if student_data and student_data.photo else '' }}" alt="" style="width:100%;height:100%;object-fit:cover;display:none;border-radius:8px" />
              <div id="avatar-initials">A</div>
            </div>
            <div class="profile-meta">
              <h3 id="profile-name">{{ student_data.name if student_data and student_data.name else "Add Your Name" }}</h3>
              <div class="muted" id="profile-role">{{ student_data.curr_role if student_data and student_data.curr_role else "Add Your Role" }}</div>
              <div class="muted">Status: <span id="profile-status">{{ student_data.status if student_data and student_data.status else "Active" }}</span></div>
            </div>
          </div>

          <div class="card">
            <div class="section-title">Education</div>
            <div class="muted-2">
              <p style="margin:0 0 6px 0">{{ student_data.branch if student_data else '' }} from {{ student_data.coll_univ if student_data else 'XYZ Institute' }} ({{ student_data.passing_year if student_data else '2025' }})</p>
            </div>
          </div>

          <div class="mid-grid">
            <div class="card">
              <div class="section-title">Skills Learnt</div>
              <div class="skill">
                <div class="name"><span>Python</span><span>90%</span></div>
                <div class="progress"><i style="width:90%"></i></div>
              </div>
            </div>

            <div class="card">
              <div class="section-title">Areas of Interest</div>
              <div class="tags">
                <div class="tag">AI Research</div>
              </div>
              <hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:12px 0">
              <div class="section-title">Traits of Character</div>
              <div class="tags">
                <div class="tag">Team Player</div>
              </div>
            </div>
          </div>

          <div class="bottom-controls">
            <button class="small-btn" id="contactBtn"><i class="fas fa-envelope"></i> Contact</button>
            <button class="small-btn" id="consultBtn"><i class="fas fa-comments"></i> Consultation</button>
          </div>
        </div>

        <aside class="col-right">
          <div class="card">
            <div class="section-title">Achievements</div>
            <div style="display:flex;gap:12px;align-items:center">
                <p class="muted-2">2x Hackathon Winner</p>
            </div>
          </div>
          
          <div class="card">
            <div class="section-title">Quick actions</div>
            <div style="display:flex;flex-direction:column;gap:8px">
              <button class="small-btn" id="quickReg">Register Student</button>
              <button class="small-btn" id="exportBtn">Export list</button>
              <button id="exportCsv" style="display:none;"></button> 
            </div>
          </div>
        </aside>
      </div>
    </section>

    <section class="page" id="profile" style="display:none">
        <div class="profile-card">
            <img src="{{ url_for('static', filename='images/' + student_data.photo) if student_data and student_data.photo else url_for('static', filename='images/cat-pfp.jpg') }}" alt="Profile Picture">
            <div class="profile-info">
                <h2 id="profile-name-value">{{ student_data.name if student_data and student_data.name else "Add Your Name" }}</h2>
                <p id="profile-email-p">Email: <span id="profile-email-value">{{ student_data.email_id if student_data and student_data.email_id else "Add Your Email" }}</span></p>
                <p id="profile-batch-p">Batch: <span id="profile-batch-value">{{ student_data.passing_year if student_data and student_data.passing_year else "Add Your Passing Year" }}</span></p>
                <p id="profile-role-p">Profession: <span id="profile-role-value">{{ student_data.curr_role if student_data and student_data.curr_role else "Add Your Profession" }}</span></p>
            </div>
        </div>

        <div class="edit-form">
            <h3>Edit Profile</h3>
            <form id="profileForm" method="POST" action="/add_details" enctype="multipart/form-data">
                
                <div><label for="fullName">Full Name *</label><input id="fullName" name="name" type="text" value="{{ student_data.name if student_data else '' }}" minlength="2" required></div>
                <div><label for="photo">Upload Photo *</label><input id="photo" name="photo" type="file" accept="image/*"><p class="hint">Allowed: JPG, PNG. Max 2MB.</p></div>
                <div><label for="college">College / Institute *</label><input id="college" name="college" type="text" value="{{ student_data.coll_univ if student_data else '' }}" required></div>
                <div>
                    <label for="branch">Branch / Department *</label>
                    <input list="courses" id="branch" name="branch" type="text" value="{{ student_data.branch if student_data else '' }}" required>
                    <datalist id="courses"></datalist>
                </div>
                <div><label for="passingyear">Passing Year *</label><input id="passingyear" name="passingyear" type="number" value="{{ student_data.passing_year if student_data else '' }}" min="1950" max="2035" required></div>
                <div><label for="rollno">University Roll No. *</label><input id="rollno" name="rollno" type="text" value="{{ student_data.university_roll_no if student_data else '' }}" required></div>
                <div><label for="email_id">E-mail Id *</label><input id="email_id" name="email_id" type="email" value="{{ student_data.email_id if student_data else '' }}" required></div>
                <div><label for="cgpa">CGPA *</label><input id="cgpa" name="cgpa" type="number" value="{{ student_data.cgpa if student_data else '' }}" step="0.01" min="0" max="10" required></div>
                <div>
                    <label for="status">Status *</label>
                    <select id="status" name="status" required>
                        <option value="">-- Select --</option>
                        <option value="Passed" {% if student_data and student_data.status == 'Passed' %}selected{% endif %}>Passed</option>
                        <option value="Not Passed" {% if student_data and student_data.status == 'Not Passed' %}selected{% endif %}>Not Passed</option>
                        <option value="Pursuing" {% if student_data and student_data.status == 'Pursuing' %}selected{% endif %}>Pursuing</option>
                    </select>
                </div>
                <div><label for="company">Current Company (if any)</label><input id="company" name="company" type="text" value="{{ student_data.current_company if student_data else '' }}" placeholder="e.g. Infosys / Not employed"></div>
                <div><label for="curr_role">Current Role (if any)</label><input id="curr_role" name="curr_role" type="text" value="{{ student_data.curr_role if student_data else '' }}" placeholder="e.g. HR / Intern"></div>

                <button type="submit">Save</button>
            </form>
        </div>

        <div class="card add-list">
            <h3>Interests</h3>
            <input type="hidden" name="interests_data" id="interests_hidden_input">
            <ul id="interestList" class="chip-list">
                {% if student_data and student_data.interests %}
                    {% for interest in student_data.interests %}
                        <li class="chip">{{ interest }}<button type="button">×</button></li>
                    {% endfor %}
                {% endif %}
            </ul>
            <button type="button" id="addInterestBtn" class="add-btn">+ Add Interest</button>
        </div>

        <div class="card add-list">
            <h3>Skills</h3>
            <input type="hidden" name="skills_data" id="skills_hidden_input">
            <ul id="skillList" class="chip-list">
                {% if student_data and student_data.skills %}
                    {% for skill in student_data.skills %}
                        <li class="chip">{{ skill }}<button type="button">×</button></li>
                    {% endfor %}
                {% endif %}
            </ul>
            <button type="button" id="addSkillBtn" class="add-btn">+ Add Skill</button>
        </div>
    </section>
    
    <section id="events" class="page" style="display:none">
      <div class="card">
        <h2>Events</h2>
        <p class="muted-2">List of events and RSVPs — placeholder content.</p>
        <ul id="events-list" style="margin-top:12px;color:var(--muted)">
          <li><strong>Alumni Meet 2025</strong> — 12 Dec 2025</li>
        </ul>
      </div>
    </section>

    <section id="projects" class="page" style="display:none">
      <div class="card">
        <h2>Projects</h2>
        <p class="muted-2">Alumni projects, showcases and portfolios.</p>
        <div style="margin-top:12px;color:var(--muted)"><strong>Project Alpha</strong> — AI research platform</div>
      </div>
    </section>

    <section id="directory" class="page" style="display:none">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2>Directory</h2>
          <div class="dir-search">
            <input placeholder="Search name or batch..." id="dirSearch" />
            <button class="small-btn" id="dirClear">Clear</button>
          </div>
        </div>

        <div style="margin-top:12px">
          <table>
            <thead><tr><th>Name</th><th>Batch</th><th>Email</th></tr></thead>
            <tbody id="dirList" style="color:var(--muted)">
              <tr><td>Aprajeeta Sharma</td><td>2018</td><td>aprajeeta@mail.com</td></tr>
              <tr><td>Nisha Sandilya</td><td>2021</td><td>nisha@mail.com</td></tr>
              <tr><td>Rohit Sharma</td><td>2020</td><td>rohit@mail.com</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="logout" class="page" style="display:none">
      <div class="card">
        <h2>Logout</h2>
        <p class="muted-2">Are you sure you want to logout?</p>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="btn" id="confirmLogout">Yes, logout</button>
          <button class="small-btn" id="cancelLogout">Cancel</button>
        </div>
      </div>
    </section>

  </main>

  <div class="modal-back" id="modalBack">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h3 id="modalTitle">Request Consultation</h3>
      <div class="form-row">
        <input id="cname" placeholder="Your name" />
        <input id="cemail" placeholder="Email" />
        <textarea id="cmsg" placeholder="Message" rows="4"></textarea>
      </div>
      <div class="actions">
        <button class="small-btn" id="cancelModal">Cancel</button>
        <button class="btn" id="sendConsult">Send Request</button>
      </div>
    </div>
  </div>

  {% endblock %}

  {% block scripts %}
  <script src="{{ url_for('static', filename='js/alumni_student_dashboard.js') }}"></script>
  {% endblock %}